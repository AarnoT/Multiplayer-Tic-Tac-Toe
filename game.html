<!DOCTYPE HTML>
<html>
    <head>
        <title>GAME</title>
        <meta charset="UTF-8">
        <script>
            function updateState() {
                regex = new RegExp('\\?id=(\\d+)');
                match_id = regex.exec(window.location.href)[1];
                req = new XMLHttpRequest();
                req.responseType = 'json';
                req.open('GET', '/game_state?id=' + match_id);
                req.onreadystatechange = function() {
                    if (req.readyState === XMLHttpRequest.DONE && req.status === 200) {
                        var state = req.response;
                        draw_grid(state.board.length);
                        draw_x(1, 1, state.board.length);
                        draw_o(2, 1, state.board.length);
                    }
                }
                req.send(null);
            }
            function draw_grid(size) {
                var canvas = document.getElementById('game_canvas');
                var context = canvas.getContext('2d');
                context.beginPath();
                for (x = canvas.width / size; x < canvas.width; x += canvas.width / size) {
                    context.moveTo(x, 0);
                    context.lineTo(x, canvas.height);
                }
                for (y = canvas.height / size; y < canvas.height; y += canvas.height / size) {
                    context.moveTo(0, y);
                    context.lineTo(canvas.width, y);
                }
                context.stroke();
                context.closePath();
            }
            function draw_x(x_pos, y_pos, size) {
                var canvas = document.getElementById('game_canvas');
                var context = canvas.getContext('2d');
                var tile_size = canvas.width / size;
                context.beginPath();
                context.moveTo(tile_size * (x_pos + 0.1), tile_size * (y_pos + 0.1));
                context.lineTo(tile_size * (x_pos + 0.9), tile_size * (y_pos + 0.9));
                context.moveTo(tile_size * (x_pos + 0.1), tile_size * (y_pos + 0.9));
                context.lineTo(tile_size * (x_pos + 0.9), tile_size * (y_pos + 0.1));
                context.stroke();
                context.closePath();
            }
            function draw_o(x_pos, y_pos, size) {
                var canvas = document.getElementById('game_canvas');
                var context = canvas.getContext('2d');
                var tile_size = canvas.width / size;
                context.beginPath();
                context.arc(tile_size * (x_pos + 0.5), tile_size * (y_pos + 0.5),
                            tile_size * 0.4, 0, 2 * Math.PI, false);
                context.stroke();
                context.closePath();
            }
        </script>
        <style>
            canvas {border: 1px solid black}
        </style>
    </head>
    <body onload="updateState();">
        <canvas id="game_canvas" width="700" height="700">
            If you see this your browser doesn't support the canvas element.
        </canvas>
    </body>
</html>